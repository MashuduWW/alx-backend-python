#!/bin/bash



set -e

echo "ğŸš€ Applying Blue Deployment..."
kubectl apply -f blue_deployment.yaml

echo "ğŸš€ Applying Green Deployment..."
kubectl apply -f green_deployment.yaml

echo "ğŸ“¦ Ensuring both deployments are running..."
kubectl get deployments -l app=messaging-app

echo "ğŸ” Checking pods..."
kubectl get pods -l app=messaging-app

# Check logs of green pods for errors
GREEN_PODS=$(kubectl get pods -l app=messaging-app,version=green -o jsonpath='{.items[*].metadata.name}')

echo "ğŸ“ Checking logs of green pods..."
for pod in $GREEN_PODS
do
    echo "â¡ï¸ Logs for $pod:"
    kubectl logs $pod || echo "âš ï¸ Failed to get logs for $pod"
done

echo "âœ… Blue-Green deployments applied successfully."
echo "ğŸ‘‰ To switch traffic to green, update kubeservice.yaml selector to 'version: green' and run:"
echo "   kubectl apply -f kubeservice.yaml"
